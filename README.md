# terraform-ansible-inventory CLI

<p align="center">

<img style="max-width:100%;" src="banner.png" alt="terraform-ansible-inventory logo containing the repository description. If you are using a screen reader: feel hugged ğŸ¤—">

</p>


A high-performance, zero-dependency Go command-line tool for building complete Ansible inventories from Terraform state generated by the `ansible/ansible` provider.

Detailed documentation is available in the [docs directory](docs/) and on the [GitHub Pages](https://hilkopterbob.github.io/terraform-ansible-inventory/) site.

The tool expects your Terraform configuration to use the `ansible/ansible` provider so that hosts, groups and variables are written to the state file.

RedHat's official inventory plugin struggles with nested modules and often misses resources. This CLI parses the state directly and fully supports child modules so you can reliably generate inventories from complex configurations.

---

## ğŸ” Features

- **Streaming JSON parsing** for huge state files without high memory use.
- **Multiple output formats**: `yaml`, `ini`, `json` and native Ansible inventory.
- **Understands provider resources** including host variables and group hierarchy.
- **Child module aware** so nested modules are fully traversed.
- **Built-in IP/CIDR handling** for `ansible_host` variables.
- **Clean CLI interface** with automatic `--help` and sensible defaults.
- **Zero dependencies** aside from the Go runtime.
- **CI ready** with smoke test data and GitHub Actions workflow.
- Filter output by host or group using `--host` and `--group` flags.

---

## ğŸ“¦ Installation

```bash
# Clone the repo:
git clone https://github.com/HilkopterBob/terraform-ansible-inventory.git
cd terraform-ansible-inventory

# Build the binary:
go build -o terraform-ansible-inventory ./main.go

# (Optional) Install globally:
go install github.com/HilkopterBob/terraform-ansible-inventory@latest

# Or download a ready-made binary from the
[releases page](https://github.com/HilkopterBob/terraform-ansible-inventory/releases).
```

### Docker image

A small container image is published for each release on
[GitHub Container Registry](https://ghcr.io).
Run it like any other command line tool or inside CI pipelines:

```bash
docker run --rm ghcr.io/hilkopterbob/terraform-ansible-inventory:latest --help
```

In GitLab CI you must override the image entrypoint so the pipeline script can
run:

```yaml
image:
  name: ghcr.io/hilkopterbob/terraform-ansible-inventory:latest
  entrypoint: [""]

generate-inventory:
  script:
    - terraform-ansible-inventory --input tf.json --format yaml > inventory.yaml
```

---

## ğŸš€ Usage

```
$ terraform-ansible-inventory --help
Usage of terraform-ansible-inventory:
  -format string
        Output format: yaml, ini, json (default "yaml")
  -input string
        Path to input JSON file (or '-' for stdin)
```

All flags can be abbreviated:

- `-i` or `--input`
- `-f` or `--format`

### Examples

Assume `state.json` is your Terraform state created with the `ansible/ansible` provider:

```bash
# 1) YAML inventory
terraform-ansible-inventory -i state.json -f yaml > inventory.yml

# 2) INI inventory
terraform-ansible-inventory -i state.json -f ini > inventory.ini

# 3) JSON machine readable form
terraform-ansible-inventory -i state.json -f json > inventory.json
```


## ğŸ”§ Contributing

1. Fork & clone the repo
2. Create a feature branch `git checkout -b feature/myfeature`
3. Add tests under `internal/*_test.go`
4. Ensure all tests pass
5. Submit a PR

---

## ğŸ“„ License

Apache-2.0 Â© Nick von Podewils

